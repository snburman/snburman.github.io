"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[455],{9372:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>h});var s=t(4848),i=t(8453);const a=t.p+"assets/images/add_task-57c7da19473e5a23d34965299d32bd71.png",o={sidebar_position:7,title:"Context"},c=void 0,r={id:"fncmp/tutorial/context",title:"Context",description:"The context passed to a HandleFn contains a Dispatch struct",source:"@site/docs/fncmp/tutorial/context.mdx",sourceDirName:"fncmp/tutorial",slug:"/fncmp/tutorial/context",permalink:"/docs/fncmp/tutorial/context",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7,title:"Context"},sidebar:"fncmpSidebar",previous:{title:"Rendering",permalink:"/docs/fncmp/tutorial/rendering"},next:{title:"Cache",permalink:"/docs/fncmp/tutorial/cache"}},d={},h=[{value:"Events",id:"events",level:3},{value:"Example: <i>Context &amp; EventListener</i>",id:"example-context--eventlistener",level:3}];function l(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["The context passed to a HandleFn contains a ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/github.com/kitkitchen/fncmp#Dispatch",children:"Dispatch"})," struct\nthat contains information needed by the client, initiated by ",(0,s.jsx)("code",{children:"fncmp.min.js"}),", to communicate with the server.\nWhile the context must remain consistent during a request, values may be stored and retrieved from the context as needed."]}),"\n",(0,s.jsxs)(n.p,{children:["One such example is an event triggered by an ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/github.com/kitkitchen/fncmp#EventListener",children:"EventListener"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"events",children:"Events"}),"\n",(0,s.jsxs)(n.p,{children:["We can see that the EventListener struct contains a context and a HandleFn. The HandleFn being the function that was ",(0,s.jsx)(n.a,{href:"/docs/fncmp/tutorial/event-listeners",children:"passed to\nthe WithEvents method"})," of the FnComponent. The context is the same context that is passed to the HandleFn."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",metastring:'title="fncmp.EventListener struct"',children:'type EventListener struct {\n\tcontext.Context `json:"-"`\n\tID              string   `json:"id"`\n\tTargetID        string   `json:"target_id"`\n\tHandler         HandleFn `json:"-"`\n\tOn              OnEvent  `json:"on"`\n\tData            any      `json:"data"`\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"When an event is triggered in the DOM, the client sends a Dispatch to the server which retrieves the\nEventListener to which the event was assigned. The context is then passed to the HandleFn, which can be used to\nretrieve information about the event. Let's change the project a bit to see how this works."}),"\n",(0,s.jsxs)(n.h3,{id:"example-context--eventlistener",children:["Example: ",(0,s.jsx)("i",{children:"Context & EventListener"})]}),"\n",(0,s.jsxs)(n.p,{children:["Start by replacing the ",(0,s.jsx)("code",{children:"div"})," tag with the following unordered list element in ",(0,s.jsx)("code",{children:"index.html"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",metastring:'{3} title="static/index.html"',children:'\x3c!-- ... --\x3e\n    <main>\n      <ul id="tasks"></ul>\n    </main>\n\x3c!-- ... --\x3e\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Update HandleMainFn in ",(0,s.jsx)("code",{children:"main.go"})," to include a form that will be used to add tasks to a to-do list."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",metastring:'{8} title="main.go"',children:"func HandleMainFn(ctx context.Context) fncmp.FnComponent {\n    form := fncmp.HTML(`\n        <form>\n            <input id='name' name='name' type='text'/>\n            <button type='submit'>Add Task</button>\n        </form>\n    `)\n    fn := fncmp.NewFn(ctx, form).WithEvents(handleSubmit, fncmp.OnSubmit)\n    return fn.AppendTag(\"main\")\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Note that the ",(0,s.jsx)("i",{children:"OnEvent"})," passed to ",(0,s.jsx)("i",{children:"WithEvents"}),' has been changed to fncmp.OnSubmit, which is equivalent to, "submit".']}),"\n",(0,s.jsxs)(n.p,{children:["The name of the callback function has also been changed to ",(0,s.jsx)("i",{children:"handleSubmit"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Package fncmp provides a utility function for parsing data from EventListeners, but first the shape of that data needs to be defined."}),"\n",(0,s.jsxs)(n.p,{children:["Define a ",(0,s.jsx)("b",{children:"Task"})," struct somewhere in ",(0,s.jsx)("code",{children:"main.go"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",metastring:'title="main.go"',children:'type Task struct {\n    Name string `json:"name"`\n    Complete bool `json:"complete"`\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Now, with a new ",(0,s.jsx)("i",{children:"handleSubmit"})," function, we can use the ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/github.com/kitkitchen/fncmp#EventData",children:"fncmp.EventData"}),"\nfunction to parse the data from the context, passing the type of data (Task) as a generic argument."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",metastring:'{2,4} title="main.go"',children:"func handleSubmit(ctx context.Context) fncmp.FnComponent {\n    task, err := fncmp.EventData[Task](ctx)\n    if err != nil {\n        return fncmp.FnErr(ctx, err)\n    }\n    //...\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Notice that, in the event that the context doesn't contain the expected Task data, we can return a ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/github.com/kitkitchen/fncmp#FnErr",children:"fncmp.FnErr"}),", much like a FnComponent with an error in place of a Component.\nThis effectively cancels the Dispatch to the client and no subsequent rendering takes place."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["OnSubmit is the only event that should always have a user defined type passed to EventData as OnSubmit returns arbitrary form data.\nOther events, such as ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/github.com/kitkitchen/fncmp#OnEvent",children:"OnMouseEnter"}),", can be parsed using\n",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/github.com/kitkitchen/fncmp#MouseEvent",children:"fncmp.MouseEvent"})," to retrieve values like the mouse's position."]})}),"\n",(0,s.jsx)(n.p,{children:"Now that we have the task, we can add it to the list of tasks."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",metastring:'{6-8} title="main.go"',children:'func handleSubmit(ctx context.Context) fncmp.FnComponent {\n    task, err := fncmp.EventData[Task](ctx)\n    if err != nil {\n        return fncmp.FnErr(ctx, err)\n    }\n    item := fncmp.HTML("<li>" + task.Name + "</li>")\n    fn := fncmp.NewFn(ctx, item)\n    return fn.AppendElement("tasks")\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Add some css to the head of ",(0,s.jsx)("code",{children:"index.html"})," to style the to-do list."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",metastring:'title="static/index.html"',children:"\x3c!-- ... --\x3e\n<head>\n    <style>\n        ul {\n            width: 230px;\n            height: 230px;\n            padding: 0;\n            overflow: scroll;\n            list-style-type: none;\n        }\n        li {\n            padding: 10px;\n            margin: 1px;\n            background-color: #f0f0f0;\n        }\n        form {\n            display: flex;\n            width: 230px;\n        }\n        input {\n            flex: 1;\n            height: 25px;\n            margin-right: 5px;\n        }\n        button {\n            border: none;\n            background-color: #0076d0;\n            color: #ffffff;\n        }\n    </style>\n\x3c!-- ... --\x3e\n"})}),"\n","\n","\n",(0,s.jsx)(n.p,{children:"Output:"}),"\n",(0,s.jsx)("img",{src:a}),"\n",(0,s.jsxs)(n.p,{children:["This to-do list isn't very useful yet, but it demonstrates how to use the context to retrieve data from an EventListener.",(0,s.jsx)(n.br,{}),"\n","In the next section, we'll use ",(0,s.jsx)(n.a,{href:"https://pkg.go.dev/github.com/kitkitchen/fncmp#Cache",children:"Cache"})," to keep track of tasks and their completion status."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(6540);const i={},a=s.createContext(i);function o(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);