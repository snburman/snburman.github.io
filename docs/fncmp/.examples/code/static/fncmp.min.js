(()=>{var u=class{constructor(){if(this.ws=null,this.addr=void 0,this.key=void 0,this.addr)throw new Error("ws: already connected to server...");let t=localStorage.getItem("fncmp_key");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var i=Math.random()*16|0,o=n=="x"?i:i&3|8;return o.toString(16)}),localStorage.setItem("fncmp_key",t)),this.key=t;let r=window.location.pathname.split(""),a="";(r[-1]=="/"||r.length==1&&r[0]=="/")&&r.pop(),a=r.join(""),a==""&&(a="/main"),this.addr="ws://"+window.location.host+a+"?fncmp_id="+this.key,this.connect()}connect(){try{this.ws=new WebSocket(this.addr)}catch(t){throw new Error("ws: failed to connect to server...")}this.ws.onopen=function(){document.getElementById("fncmp_script").remove()},this.ws.onclose=function(){},this.ws.onerror=function(t){},this.ws.onmessage=function(t){let r=JSON.parse(t.data);y.Process(this,r)}}},d=class{constructor(){this.ws=null,this.Dispatch=t=>{if(t){if(!this.ws)throw new Error("ws: not connected to server...");this.ws.send(JSON.stringify(t))}},this.funs={initialize:t=>{t=this.utils.parseEventListeners(document.body,t),this.Dispatch(this.utils.addEventListeners(t))},render:t=>{let r=null,n=new DOMParser().parseFromString(t.render.html,"text/html").firstChild.getElementsByTagName("body")[0].innerHTML;if(t.render.tag!=""){if(r=document.getElementsByTagName(t.render.tag)[0],!r)return this.Error(t,"element with tag not found: "+t.render.tag)}else if(t.render.target_id!=""){if(r=document.getElementById(t.render.target_id),!r)return this.Error(t,"element with target_id not found: "+t.render.target_id)}else return this.Error(t,"no target or tag specified");t.render.inner&&(r.innerHTML=n),t.render.outer&&(r.outerHTML=n),t.render.append&&(r.innerHTML+=n),t.render.prepend&&(r.innerHTML=n+r.innerHTML),t=this.utils.parseEventListeners(r,t),this.Dispatch(this.utils.addEventListeners(t))}},this.utils={parseEventListeners:(t,r)=>{let o=this.utils.getAttributes(t,"events").map(c=>{let f=JSON.parse(c);if(f)return f}).flat().filter(c=>c!=null);return r.render.event_listeners=o,r},parseFormData:(t,r)=>{let a=t.target,n=new FormData(a);return r.event.data=Object.fromEntries(n.entries()),r},getElementByAttribute:t=>document.querySelectorAll("[".concat(t,"]")),trackTouch:t=>{t.addEventListener("touchstart",r=>{r.preventDefault(),t.classList.add("touch")}),t.addEventListener("touchend",r=>{t.classList.remove("touch")})},getAttributes:(t,r)=>{let a=t.querySelectorAll("[".concat(r,"]"));return Array.from(a).map(n=>n.getAttribute(r))},addEventListeners:t=>{t.render.event_listeners&&t.render.event_listeners.forEach(r=>{let a=document.getElementById(r.target_id);if(!a){this.Error(t,"element not found");return}a.firstChild&&(a=a.firstChild),a.addEventListener(r.on,n=>{switch(n.preventDefault(),t.function="event",t.event=r,r.on){case"submit":t=this.utils.parseFormData(n,t);break;case"pointerdown":t.event.data=m(n);break;case"drag":t.event.data=p(n);break;case"mousedown":t.event.data=g(n);break;case"keydown":t.event.data=b(n);break;case"change":t.event.data=s(n.target);break;case"touchstart":t.event.data=h(n);break;default:t.event.data=s(n.target)}this.Dispatch(t)})})}},this.Error=(t,r)=>{t.function="error",t.error.message=r,this.Dispatch(t)}}Process(t,r){switch(this.ws||(this.ws=t),r.function){case"initialize":this.Dispatch(this.funs.initialize(r));return;case"redirect":window.location.href=r.redirect.url;return;case"custom":this.Dispatch(window[r.custom.function](r.custom.data));return;case"render":this.Dispatch(this.funs.render(r));default:break}}};function s(e){return{id:e.id||"",name:e.name||"",tagName:e.tagName||"",innerHTML:e.innerHTML||"",outerHTML:e.outerHTML||"",value:e.value||""}}function m(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:s(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,height:e.height,isPrimary:e.isPrimary,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,pointerId:e.pointerId,pointerType:e.pointerType,pressure:e.pressure,relatedTarget:s(e.relatedTarget)}}function h(e){return{changedTouches:Array.from(e.changedTouches).map(t=>l(t)),targetTouches:Array.from(e.targetTouches).map(t=>l(t)),touches:Array.from(e.touches).map(t=>l(t)),layerX:e.layerX,layerY:e.layerY,pageX:e.pageX,pageY:e.pageY}}function l(e){return{clientX:e.clientX,clientY:e.clientY,identifier:e.identifier,pageX:e.pageX,pageY:e.pageY,radiusX:e.radiusX,radiusY:e.radiusY,rotationAngle:e.rotationAngle,screenX:e.screenX,screenY:e.screenY,target:s(e.target)}}function p(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:s(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,relatedTarget:s(e.relatedTarget)}}function g(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,button:e.button,buttons:e.buttons,cancelable:e.cancelable,clientX:e.clientX,clientY:e.clientY,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:s(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,metaKey:e.metaKey,movementX:e.movementX,movementY:e.movementY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,relatedTarget:s(e.relatedTarget)}}function b(e){return{isTrusted:e.isTrusted,altKey:e.altKey,bubbles:e.bubbles,cancelable:e.cancelable,code:e.code,composed:e.composed,ctrlKey:e.ctrlKey,currentTarget:s(e.currentTarget),defaultPrevented:e.defaultPrevented,detail:e.detail,eventPhase:e.eventPhase,isComposing:e.isComposing,key:e.key,location:e.location,metaKey:e.metaKey,repeat:e.repeat,shiftKey:e.shiftKey}}var y=new d;new u;})();
